<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Tap Master</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Montserrat:wght@500;700&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#0e0e0e;
  --glass-bg: rgba(255,255,255,0.04);
  --accent1:#FF1493;
  --accent2:#FF8C00;
  --green1:#00e676;
  --muted:#aaa;
  --glass-border: rgba(255,255,255,0.08);
}

*{box-sizing:border-box}
html,body {height:100%;margin:0;background:var(--bg);color:#fff;font-family:'Montserrat',sans-serif; -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
body {display:flex;justify-content:center;align-items:flex-start;padding:18px 0 120px; touch-action:manipulation; -webkit-tap-highlight-color: transparent; overflow-x:hidden;}
#appWrapper {width:100%;max-width:480px;display:flex;flex-direction:column;align-items:center;}

/* header */
#gameHeader{text-align:center;margin-top:6px;}
#welcomeText{font-family:'Press Start 2P',cursive;font-size:11px;color:var(--accent1)}
#scrambleText{font-family:'Press Start 2P',cursive;font-size:20px;color:var(--accent1);margin-top:4px}

/* glass terminal (tap stats + timer etc) */
.glass-terminal {
  width: 90%;
  max-width: 420px;
  margin: 18px auto;
  padding: 14px 16px;
  background: var(--glass-bg);
  border: 1px solid var(--glass-border);
  border-radius: 14px;
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  box-shadow: 0 0 20px rgba(0,0,0,0.6);
  color: #fff;
  position: relative;
  overflow: hidden;
}
.terminal-header { text-align:center; color:var(--accent1); font-size:11px; letter-spacing:2px; margin-bottom:8px; font-weight:700; }
.terminal-line { font-size:13px; line-height:1.6; letter-spacing:1px; color:#fff; margin-bottom:6px; display:flex; justify-content:space-between; align-items:center; }
.terminal-line span { color:#00FF99; text-shadow:0 0 6px rgba(0,255,153,0.08); font-weight:700; }

/* train bar (timer visual) */
#trainBarContainer {
  width:100%;
  height:14px;
  background: rgba(255,255,255,0.03);
  border-radius: 999px;
  overflow:hidden;
  margin-top:8px;
}
#trainBar {
  height:100%;
  width:100%;
  background: linear-gradient(90deg, var(--accent1), var(--accent2));
  transform-origin: left center;
  transition: width 0.2s linear;
}

/* stats row inside terminal */
.stats-row { display:flex; justify-content:space-between; gap:12px; margin-top:8px; align-items:center; }
.stat { flex:1; background: rgba(255,255,255,0.02); padding:8px; border-radius:8px; text-align:center; }
.stat .label { font-size:11px; color:var(--muted); }
.stat .value { font-size:16px; font-weight:800; color:#fff; }

/* bonus bar (progress toward next bonus level) */
#bonusContainer { width:100%; height:10px; background:#111; border-radius:999px; overflow:hidden; margin-top:12px; box-shadow:0 6px 16px rgba(0,0,0,0.6) inset; }
#bonusBar { height:100%; width:0%; background:linear-gradient(90deg,var(--green1),#00b0ff); transition:width .15s linear; }

/* TAP button - small round, far from terminal */
#tapButton {
  width:64px;
  height:64px;
  border-radius:50%;
  background: radial-gradient(circle at 25% 25%, var(--green1), #00b0ff);
  border: none;
  margin-top:36px; /* far from terminal */
  box-shadow: 0 8px 30px rgba(0,230,118,0.14);
  display:inline-flex;
  align-items:center;
  justify-content:center;
  font-weight:800;
  color:#000;
  font-size:18px;
  -webkit-user-select:none;
  user-select:none;
  -webkit-tap-highlight-color: transparent;
}

/* tap hover/active */
#tapButton:active { transform: scale(.96); }

/* tap count + earnings small status (below button) */
#miniStats { margin-top:12px; color:#fff; font-weight:700; }

/* leaderboard button */
#leaderboardBtn {
  margin-top:14px;
  padding:10px 14px;
  border-radius:10px;
  background: linear-gradient(90deg,#FFD700,#FF8C00);
  color:#111;
  font-weight:800;
  border:none;
  cursor:pointer;
  font-size:14px;
}

/* modal (normal fade-in centered) */
.modal-backdrop {
  position:fixed; inset:0; background: rgba(0,0,0,0.6); display:none; align-items:center; justify-content:center; z-index:9999;
}
.modal {
  width:92%; max-width:420px; background:#0f0f0f; border-radius:12px; padding:16px; border:1px solid rgba(255,255,255,0.06);
  box-shadow: 0 10px 30px rgba(0,0,0,0.6);
}
.modal h3{ margin:0 0 8px 0; color:var(--accent1); font-size:16px; }
.modal .list { text-align:left; margin-top:12px; max-height:320px; overflow:auto; }
.modal .list li { padding:8px 6px; border-bottom:1px dashed rgba(255,255,255,0.03); font-weight:700; }

/* result panel (small) */
#resultModalInner { display:none; margin-top:18px; }

/* small helpers */
.hidden { display:none!important; }
button, input { font-size:16px; } /* prevents iOS zoom on tap */
</style>
</head>
<body>
<div id="appWrapper">

  <!-- Header -->
  <div id="gameHeader">
    <div id="welcomeText">WELCOME TO</div>
    <div id="scrambleText">TAP MASTER</div>
  </div>
  

<!-- Start Page -->
<div id="startPage" style="width:100%;display:flex;flex-direction:column;align-items:center;margin-top:18px;">
  <button id="startBtn" style="padding:12px 22px;border-radius:12px;background:linear-gradient(90deg,#00e676,#00b0ff);color:#000;font-weight:800;font-size:16px;border:none;cursor:pointer;">Play</button>
  <img id="posterImg" src="https://via.placeholder.com/420x200?text=Poster+Here" alt="Poster" style="width:90%;max-width:420px;margin:12px auto;border-radius:12px;">
</div>

<!-- Play Confirmation Modal -->
<div id="playModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);z-index:2000;justify-content:center;align-items:center;display:flex;">
  <div style="background:#111;color:#fff;padding:20px;border-radius:12px;width:90%;max-width:320px;text-align:center;">
    <h3 style="margin-bottom:12px;">Confirm Play</h3>
    <p>Spend <strong>10 ‚≠ê</strong> to start this game?</p>
    <div style="display:flex;justify-content:space-between;margin-top:18px;">
      <button id="cancelPlay" style="flex:1;margin-right:6px;padding:10px 12px;border:none;border-radius:8px;background:#444;color:#fff;font-weight:700;cursor:pointer;">Cancel</button>
      <button id="confirmPlay" style="flex:1;margin-left:6px;padding:10px 12px;border:none;border-radius:8px;background:linear-gradient(90deg,#00e676,#00b0ff);color:#000;font-weight:700;cursor:pointer;">Confirm</button>
    </div>
  </div>
</div>

  <!-- Spinner (loading animation) -->
  <div id="spinner" class="hidden" style="margin-top:18px;">
    <div style="width:44px;height:44px;border-radius:50%;border:6px solid #222;border-top:6px solid #00e676; animation:spin 1s linear infinite;margin:0 auto"></div>
    <div style="margin-top:10px;color:#aaa;font-size:13px">Loading Tap Arena‚Ä¶</div>
  </div>
  
  

  <!-- Game UI -->
  <div id="gamePage" class="hidden" style="width:100%;display:flex;flex-direction:column;align-items:center;">

    <!-- Glass terminal -->
    <div id="tapTerminal" class="glass-terminal" aria-live="polite">
      <div class="terminal-header">TAP TERMINAL</div>

      <div class="terminal-line">
        <div>‚è± Time Left</div>
        <div><span id="timer">60</span>s</div>
      </div>

      <div class="terminal-line">
        <div>üëÜ Taps</div>
        <div><span id="tapCount">0</span></div>
      </div>

      <div class="terminal-line">
        <div>üíµ Earnings</div>
        <div>‚Ç¶<span id="earnings">0.00</span></div>
      </div>

      <div id="trainBarContainer" style="margin-top:10px;">
        <div id="trainBar" style="width:100%"></div>
      </div>

      <div class="stats-row" style="margin-top:10px">
        <div class="stat">
          <div class="label">BONUS LVL</div>
          <div class="value" id="bonusLevelVal">1</div>
        </div>
        <div class="stat">
          <div class="label">SPEED</div>
          <div class="value" id="speedVal">‚Äî</div>
        </div>
      </div>

      <div id="bonusContainer" style="margin-top:12px;">
        <div id="bonusBar"></div>
      </div>
    </div>

    <!-- TAP button -->
    <button id="tapButton" aria-label="Tap" title="Tap fast!">TAP</button>

    <!-- Mini stats -->
    <div id="miniStats" aria-hidden="false">Taps: <strong id="miniTapCount">0</strong> ¬∑ Earnings: ‚Ç¶<span id="miniEarnings">0.00</span></div>

    <!-- Result modal -->
<div id="resultModal" class="modal-backdrop" style="display:none;align-items:center;justify-content:center;">
  <div class="modal" style="padding:16px;border-radius:12px;max-width:380px;text-align:center;position:relative;">
    <button id="closeResult" style="position:absolute;top:8px;right:8px;font-size:18px;border:none;background:none;cursor:pointer;">‚úñ</button>
    <div id="resultMessage" style="margin-top:10px;font-size:16px;font-weight:600;"></div>
    <button id="playAgainBtn" style="margin-top:16px;padding:10px 16px;border-radius:8px;border:none;background:linear-gradient(90deg,#00e676,#00b0ff);color:#000;font-weight:800;cursor:pointer;">Play Again</button>
  </div>
</div>

  </div> <!-- end gamePage -->

  <!-- Fixed bottom profile + leaderboard button -->
  <div id="bottomBar" style="position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:90%;max-width:480px;display:flex;flex-direction:column;align-items:center;gap:6px;z-index:1000;">
    <div class="profile-card" style="background:rgba(255,255,255,0.04);padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);text-align:center;">
      <div class="profile-name" id="profileName">GUEST 0000</div>
      <div class="profile-info">STARS COLLECTED: <span id="starCount">50</span>‚≠ê</div>
      <div class="profile-info">CASH EARNED: <span id="cashCount">0</span></div>
    </div>
    <button id="leaderboardBtn" style="padding:10px 14px;border-radius:10px;background:linear-gradient(90deg,#FFD700,#FF8C00);color:#111;font-weight:800;border:none;cursor:pointer;font-size:14px;">View Leaderboard üèÜ</button>
  </div>

  <!-- Leaderboard modal -->
  <div id="leaderboardModal" class="modal-backdrop" role="dialog" aria-modal="true">
    <div class="modal">
      <h3>Top Tappers ‚Äî This Hour</h3>
      <ol id="leaderboardList" class="list" style="list-style:none;padding-left:0;margin:0;"></ol>
      <div style="margin-top:12px;text-align:right;">
        <button id="closeLeaderboard" style="padding:8px 12px;border-radius:8px;border:none;background:linear-gradient(90deg,#FF1493,#FF8C00);color:#fff;font-weight:800;cursor:pointer">Close</button>
      </div>
    </div>
  </div>

</div>

<!-- Audio -->
<audio id="tapSound" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg" preload="auto"></audio>

<!-- Replace your current script with this -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import {
  getFirestore, collection, addDoc,
  query, where, orderBy, limit, getDocs,
  serverTimestamp, Timestamp
} from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

/* ---------- Firebase config ---------- */
const firebaseConfig = {
  apiKey: "AIzaSyDbKz4ef_eUDlCukjmnK38sOwueYuzqoao",
  authDomain: "metaverse-1010.firebaseapp.com",
  projectId: "metaverse-1010",
  storageBucket: "metaverse-1010.appspot.com",
  messagingSenderId: "1044064238233",
  appId: "1:1044064238233:web:2fbdfb811cb0a3ba349608",
  measurementId: "G-S77BMC266C",
  databaseURL: "https://metaverse-1010-default-rtdb.firebaseio.com/"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ---------- UI refs ---------- */
const startBtn = document.getElementById('startBtn');
const playModal = document.getElementById('playModal');
const cancelPlay = document.getElementById('cancelPlay');
const confirmPlay = document.getElementById('confirmPlay');
const spinner = document.getElementById('spinner');
const startPage = document.getElementById('startPage');
const gamePage = document.getElementById('gamePage');
const tapButton = document.getElementById('tapButton');
const tapSound = document.getElementById('tapSound');
const timerEl = document.getElementById('timer');
const tapCountEl = document.getElementById('tapCount');
const earningsEl = document.getElementById('earnings');
const bonusBar = document.getElementById('bonusBar');
const trainBar = document.getElementById('trainBar');
const bonusLevelVal = document.getElementById('bonusLevelVal');
const speedVal = document.getElementById('speedVal');
const miniTapCount = document.getElementById('miniTapCount');
const miniEarnings = document.getElementById('miniEarnings');
const leaderboardBtn = document.getElementById('leaderboardBtn');
const leaderboardModal = document.getElementById('leaderboardModal');
const leaderboardList = document.getElementById('leaderboardList');
const closeLeaderboard = document.getElementById('closeLeaderboard');
const resultInner = document.getElementById('resultModalInner');
const finalTapsEl = document.getElementById('finalTaps');
const finalPlaceEl = document.getElementById('finalPlace');
const playAgain = document.getElementById('playAgain');
const posterImg = document.getElementById('posterImg');
const starCountEl = document.getElementById('starCount');
const profileNameEl = document.getElementById('profileName') || { textContent: 'GUEST' };

/* ---------- State ---------- */
let taps = 0;
let earnings = 0;
let timer = 60;
let duration = 60;
let intervalId = null;
let running = false;
let bonusLevel = 1;
let progress = 0;
let tapsForNext = 100;

/* choose event */
const tapEvent = ('ontouchstart' in window) ? 'touchstart' : 'click';

/* unlock audio on first touch for iOS */
document.body.addEventListener('touchstart', () => { if (tapSound) tapSound.play().catch(()=>{}); }, { once:true });

/* ---------- Start flow (confirm modal) ---------- */
startBtn?.addEventListener('click', () => {
  if (!playModal) {
    // fallback: start immediately if modal missing
    beginPlayFlow();
    return;
  }
  playModal.style.display = 'flex';
});

cancelPlay?.addEventListener('click', () => {
  playModal.style.display = 'none';
});

confirmPlay?.addEventListener('click', async () => {
  // cost in stars
  const cost = 10;
  const stars = parseInt(starCountEl?.textContent || '0', 10);
  if (isNaN(stars) || stars < cost) {
    alert('Not enough stars to play!');
    return;
  }

  // deduct UI-wise (you can also perform Firestore transaction if needed)
  starCountEl.textContent = String(stars - cost);

  // hide modal, poster, show spinner and then start session
  playModal.style.display = 'none';
  if (posterImg) posterImg.style.display = 'none';
  if (startPage) startPage.style.display = 'none';
  if (spinner) spinner.classList.remove('hidden');

  setTimeout(() => {
    if (spinner) spinner.classList.add('hidden');
    if (gamePage) gamePage.classList.remove('hidden');
    startSession();
  }, 700);
});

/* If user directly wants to begin play flow without modal */
function beginPlayFlow(){
  if (posterImg) posterImg.style.display = 'none';
  if (startPage) startPage.style.display = 'none';
  if (spinner) spinner.classList.remove('hidden');
  setTimeout(() => {
    if (spinner) spinner.classList.add('hidden');
    if (gamePage) gamePage.classList.remove('hidden');
    startSession();
  }, 700);
}

/* ---------- Session start / timer ---------- */
function startSession(){
  taps = 0;
  earnings = 0;
  timer = duration;
  bonusLevel = 1;
  progress = 0;
  tapsForNext = 100;
  running = true;
  updateUI();

  if (trainBar) trainBar.style.width = '100%';

  // ensure tap button enabled
  if (tapButton) { tapButton.disabled = false; tapButton.classList.remove('disabled'); }

  // countdown
  clearInterval(intervalId);
  intervalId = setInterval(() => {
    timer--;
    if (timer < 0) timer = 0;
    updateUI();
    if (trainBar) trainBar.style.width = Math.max(0, (timer/duration)*100) + '%';
    if (timer === 0) {
      endSession();
    }
  }, 1000);
}

/* ---------- Tap handler ---------- */
tapButton?.addEventListener(tapEvent, (e) => {
  e.preventDefault();
  if (!running) return;

  taps += 1;
  earnings += 1; // per-tap earning
  progress += 1;

  // visual feedback: glow + micro-buzz (vibration)
  tapButton.classList.add('tap-glow');
  setTimeout(()=> tapButton.classList.remove('tap-glow'), 120);
  if (navigator.vibrate) navigator.vibrate(10);

  // float text
  showFloat('+‚Ç¶1.00', tapButton);

  // bonus level check
  if (progress >= tapsForNext) {
    progress = 0;
    bonusLevel++;
    tapsForNext = 100 + (bonusLevel - 1) * 50;
    showTempMessage('TAP PRO!');
  }

  // UI update and sound
  updateUI();
  if (tapSound) { tapSound.currentTime = 0; tapSound.play().catch(()=>{}); }
});

/* ---------- Update UI ---------- */
function updateUI(){
  if (timerEl) timerEl.textContent = String(timer);
  if (tapCountEl) tapCountEl.textContent = String(taps);
  if (earningsEl) earningsEl.textContent = earnings.toFixed(2);
  if (bonusBar) bonusBar.style.width = ((progress / tapsForNext) * 100) + '%';
  if (bonusLevelVal) bonusLevelVal.textContent = String(bonusLevel);
  if (speedVal) speedVal.textContent = (taps > 0 && duration - timer > 0) ? Math.round(taps / Math.max(1, (duration - timer))) + '/s' : '‚Äî';
  if (miniTapCount) miniTapCount.textContent = String(taps);
  if (miniEarnings) miniEarnings.textContent = earnings.toFixed(2);
}

/* ---------- End session: save & show end modal ---------- */
async function endSession(){
  if (!running) return;
  running = false;
  clearInterval(intervalId); intervalId = null;

  // disable tap button
  if (tapButton) { tapButton.disabled = true; }

  // save session to Firestore
  try {
    await addDoc(collection(db, 'tapSessions'), {
      taps,
      earnings,
      timestamp: serverTimestamp()
    });
  } catch (err) {
    console.error('Failed to save session', err);
  }

  // compute place in the last hour
  let placeText = '‚Äî';
  try {
    const oneHourAgo = Timestamp.fromDate(new Date(Date.now() - 3600 * 1000));
    const q = query(
      collection(db, 'tapSessions'),
      where('timestamp', '>', oneHourAgo),
      orderBy('taps', 'desc'),
      limit(100) // fetch top 100 to find place reliably
    );
    const snap = await getDocs(q);
    const arr = snap.docs.map(d => d.data().taps || 0);
    const all = arr.slice();
    all.push(taps);
    all.sort((a,b)=>b-a);
    const idx = all.indexOf(taps);
    placeText = (idx >= 0) ? `#${idx + 1}` : '‚Äî';
  } catch (err) {
    console.warn('Place compute failed', err);
  }

  // Show the end modal (built dynamically so you don't need new HTML)
  const username = (profileNameEl && profileNameEl.textContent) ? profileNameEl.textContent : 'PLAYER';
  showEndModal({
    username,
    earnings,
    taps,
    placeText
  });

  // refresh leaderboard data in background
  loadLeaderboardIntoModal();
}

/* ---------- Show dynamic End Modal ---------- */
function showEndModal({ username, earnings, taps, placeText }) {
  // remove existing if present
  document.getElementById('endGameModal')?.remove();

  const overlay = document.createElement('div');
  overlay.id = 'endGameModal';
  Object.assign(overlay.style, {
    position: 'fixed', inset: 0, background: 'rgba(0,0,0,0.6)',
    display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 10000
  });

  const box = document.createElement('div');
  Object.assign(box.style, {
    width: '92%', maxWidth: '420px', background: '#0f0f0f', padding: '18px', borderRadius: '12px',
    border: '1px solid rgba(255,255,255,0.06)', textAlign: 'center', color: '#fff'
  });

  const title = document.createElement('div');
  title.textContent = `${username}, time's up!`;
  title.style.fontWeight = '800';
  title.style.color = 'var(--accent1)';
  title.style.marginBottom = '8px';

  const info = document.createElement('div');
  info.innerHTML = `<div style="margin:8px 0">You earned <strong>‚Ç¶${Number(earnings).toFixed(2)}</strong> and made <strong>${taps}</strong> taps.</div>
                    <div style="margin:6px 0">Your place this hour: <strong>${placeText}</strong></div>`;

  const actions = document.createElement('div');
  actions.style.marginTop = '12px';
  actions.style.display = 'flex';
  actions.style.justifyContent = 'center';
  actions.style.gap = '10px';

  const playAgainBtn = document.createElement('button');
  playAgainBtn.textContent = 'Play again';
  Object.assign(playAgainBtn.style, { padding:'8px 14px', borderRadius:'8px', border:'none', cursor:'pointer', background:'linear-gradient(90deg,#00e676,#00b0ff)', color:'#000', fontWeight:800 });
  playAgainBtn.addEventListener('click', () => {
    overlay.remove();
    // reset small UI and start session immediately
    if (resultInner) resultInner.classList.add('hidden');
    if (tapButton) { tapButton.disabled = false; }
    startSession();
  });

  const closeBtn = document.createElement('button');
  closeBtn.textContent = 'Close ‚úï';
  Object.assign(closeBtn.style, { padding:'8px 12px', borderRadius:'8px', border:'none', cursor:'pointer', background:'linear-gradient(90deg,#FF1493,#FF8C00)', color:'#fff', fontWeight:800 });
  closeBtn.addEventListener('click', () => {
    overlay.remove();
    // show start page again
    if (startPage) startPage.style.display = 'flex';
    if (posterImg) posterImg.style.display = 'block';
  });

  actions.appendChild(playAgainBtn);
  actions.appendChild(closeBtn);

  // optional smaller leaderboard button inside modal
  const lbBtn = document.createElement('button');
  lbBtn.textContent = 'View Leaderboard';
  Object.assign(lbBtn.style, { marginTop: '12px', padding:'8px 12px', borderRadius:'8px', border:'1px solid rgba(255,255,255,0.06)', background:'#111', color:'#fff', cursor:'pointer' });
  lbBtn.addEventListener('click', () => {
    overlay.remove();
    leaderboardBtn?.click();
  });

  box.appendChild(title);
  box.appendChild(info);
  box.appendChild(actions);
  box.appendChild(lbBtn);

  overlay.appendChild(box);
  document.body.appendChild(overlay);
}

/* ---------- Leaderboard modal load ---------- */
async function loadLeaderboardIntoModal(){
  if (!leaderboardModal) return;
  leaderboardList.innerHTML = '<li style="color:#aaa">Loading‚Ä¶</li>';
  leaderboardModal.style.display = 'flex';
  try {
    const oneHourAgo = Timestamp.fromDate(new Date(Date.now() - 3600 * 1000));
    const q = query(collection(db, 'tapSessions'), where('timestamp', '>', oneHourAgo), orderBy('taps', 'desc'), limit(10));
    const snap = await getDocs(q);
    if (snap.empty) {
      leaderboardList.innerHTML = '<li style="color:#aaa">No scores this hour</li>';
    } else {
      leaderboardList.innerHTML = snap.docs.map((d,i) => {
        const data = d.data();
        const t = data.taps || 0;
        const earn = (data.earnings || 0).toFixed(2);
        const when = data.timestamp && data.timestamp.toDate ? data.timestamp.toDate().toLocaleTimeString() : '';
        return `<li style="padding:8px 6px;border-bottom:1px dashed rgba(255,255,255,0.03)"><strong>#${i+1}</strong> ‚Äî ${t} taps &nbsp; (‚Ç¶${earn}) <div style="font-size:11px;color:#aaa">${when}</div></li>`;
      }).join('');
    }
  } catch (err) {
    leaderboardList.innerHTML = '<li style="color:#f88">Failed to load</li>';
    console.error('Leaderboard load failed', err);
  }
}

/* show leaderboard on button click (manual) */
leaderboardBtn?.addEventListener('click', loadLeaderboardIntoModal);
closeLeaderboard?.addEventListener('click', () => { if (leaderboardModal) leaderboardModal.style.display = 'none'; });
leaderboardModal?.addEventListener('click', (e) => { if (e.target === leaderboardModal) leaderboardModal.style.display = 'none'; });

/* ---------- Small helpers ---------- */
function showFloat(text, anchorEl) {
  const f = document.createElement('div');
  f.className = 'floatText';
  f.textContent = text;
  const r = (anchorEl && anchorEl.getBoundingClientRect) ? anchorEl.getBoundingClientRect() : { left: window.innerWidth/2, top: window.innerHeight/2, width:0, height:0 };
  const x = (Math.random() - 0.5) * 80;
  f.style.position = 'fixed';
  f.style.left = (r.left + r.width/2) + 'px';
  f.style.top = (r.top + r.height/2) + 'px';
  f.style.transform = 'translate(-50%, -50%)';
  f.style.padding = '6px 10px';
  f.style.background = '#000';
  f.style.border = '1px solid rgba(255,255,255,0.06)';
  f.style.borderRadius = '8px';
  f.style.zIndex = 9999;
  document.body.appendChild(f);
  setTimeout(()=> { f.style.transition = 'all .6s ease'; f.style.opacity = '0'; f.style.transform = `translate(-50%, -120px) translateX(${x}px)`; }, 10);
  setTimeout(()=> f.remove(), 700);
}

function showTempMessage(txt){
  const msg = document.createElement('div'); msg.textContent = txt;
  Object.assign(msg.style,{position:'fixed',left:'50%',top:'30%',transform:'translateX(-50%)',background:'#000',padding:'10px 16px',borderRadius:'8px',border:'1px solid rgba(255,255,255,0.06)',zIndex:9999});
  document.body.appendChild(msg);
  setTimeout(()=>{ msg.style.transition='opacity .4s'; msg.style.opacity=0; setTimeout(()=>msg.remove(),400); },900);
}

/* prevent double-tap to zoom (iOS) */
document.addEventListener('gesturestart', e => { e.preventDefault(); }, { passive: false });

</script>
</body>
</html>