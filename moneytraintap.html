<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Money Train ‚Äî Tap Master</title>

<style>
  :root{
    --glass: rgba(255,255,255,0.04);
    --accent:#FF8C00;
  }

  body {
    margin: 0;
    font-family: Arial, Helvetica, sans-serif;
    background: #0e0e0e;
    color: #fff;
    text-align: center;
    touch-action: manipulation;
    overflow-x: hidden;
  }

  h1 {
    color: #00e676;
    text-shadow: 0 0 10px #00e67666;
    margin: 20px 0 10px;
    font-size: 22px;
  }

  /* ---------- Start Page ---------- */
  #startPage {
    height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    padding-top: 20px;
    background: #0e0e0e;
  }

  #posterImg {
    width: 90%;
    max-width: 420px;
    border-radius: 12px;
    margin: 12px auto;
  }

  #startBtn {
    margin-top: 20px;
    padding: 14px 36px;
    font-size: 20px;
    font-weight: bold;
    background: linear-gradient(90deg,#00e676,#00b0ff);
    color: #000;
    border-radius: 12px;
    cursor: pointer;
    border: none;
    box-shadow: 0 0 15px #00e676aa;
  }

  /* ---------- Profile Panel ---------- */
  .profile {
    position: fixed;
    bottom: var(--profile-bottom, 140px);
    left: 50%;
    transform: translateX(-50%);
    width: 90%;
    max-width: 480px;
    display: flex;
    justify-content: center;
    z-index: 1000;
    pointer-events: auto;
    transition: bottom 0.3s ease;
  }

  .profile-card {
    background: var(--glass);
    padding: 10px;
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.04);
    display: flex;
    flex-direction: column;
    gap: 6px;
    text-align: center;
  }

  .profile-name {
    font-weight: 800;
    font-size: 14px;
    color: var(--accent);
  }

  .profile-info {
    font-size: 12px;
    color: #fff;
  }

  /* ---------- Glass Terminal ---------- */
  .glass-terminal {
    width: 90%;
    max-width: 420px;
    margin: 12px auto;
    padding: 14px 18px;
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 14px;
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    box-shadow: 0 0 18px rgba(255,20,147,0.18);
    font-family: 'Press Start 2P', cursive;
    color: #FF8C00;
    text-align: left;
    position: relative;
    overflow: hidden;
  }
  .glass-terminal::before { content:''; position:absolute; top:0; left:0; width:100%; height:100%; border-radius:14px; background:linear-gradient(120deg, rgba(255,20,147,0.18), rgba(255,140,0,0.12)); pointer-events:none; opacity:0.28; }
  .terminal-header { text-align:center; color:#FF1493; font-size:10px; letter-spacing:2px; margin-bottom:8px; text-shadow:0 0 8px #FF1493aa; }
  .terminal-line { font-size:11px; line-height:1.6; letter-spacing:1px; color:#fff; margin-bottom:4px; display:flex; justify-content:space-between; }
  .terminal-line span { color:#00FF99; text-shadow:0 0 6px #00FF99; }

  /* ---------- Game Page ---------- */
  #gamePage {
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: space-between;
    height: 100vh;
    padding: 20px;
    box-sizing: border-box;
  }

  #tapButton {
    width: 130px;
    height: 130px;
    border-radius: 50%;
    background: radial-gradient(circle at top left,#00e676,#00b0ff);
    font-size: 22px;
    font-weight: bold;
    color: #000;
    box-shadow: 0 0 25px #00e676aa;
    border: none;
    cursor: pointer;
    margin: 20px 0;
    transition: transform 0.1s ease, box-shadow 0.1s ease;
  }

  #tapButton.glow {
    box-shadow: 0 0 30px #00e676, 0 0 40px #00b0ff;
    transform: scale(1.08);
  }

  /* Bonus Bar */
  #bonusContainer {
    width: 280px;
    height: 22px;
    background:#333;
    border-radius:12px;
    overflow:hidden;
    margin:10px auto 10px;
    box-shadow:0 0 10px #00e67644;
  }
  #bonusBar {
    height:100%;
    width:0;
    background:linear-gradient(90deg,#00e676,#00b0ff);
    transition:width .2s;
  }

  /* Modal */
  #modal,#leaderboardModal,#resultModal {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.8);
    display: none;
    align-items: center;
    justify-content: center;
    flex-direction: column;
  }

  .modal-box {
    background:#1e1e1e;
    padding:25px;
    border-radius:12px;
    width:80%;
    max-width:320px;
  }

  .modal-box button{
    margin:10px;
    padding:10px 25px;
    font-weight:bold;
    border-radius:8px;
    cursor:pointer;
  }

  /* Leaderboard */
  #leaderboardBtn {
    padding:10px 25px;
    border-radius:10px;
    border:none;
    margin-top:10px;
    font-weight:bold;
    background: linear-gradient(90deg,#FF1493,#FF8C00);
    color:#000;
    cursor:pointer;
  }

</style>
</head>
<body>

<!-- Start Page -->
<div id="startPage">
  <h1>WELCOME TO<br>MONEY TRAIN ‚Äî TAP MASTER</h1>
  <img id="posterImg" src="https://via.placeholder.com/420x200?text=Poster+Here" alt="Poster">
  <button id="startBtn">Play</button>
</div>

<!-- Profile Panel -->
<div class="profile" id="profilePanel">
  <div class="profile-card">
    <div class="profile-name" id="profileName">GUEST 0000</div>
    <div class="profile-info">STARS COLLECTED: <span id="starCount">50</span>‚≠ê</div>
    <div class="profile-info">CASH EARNED: <span id="cashCount">0</span></div>
  </div>
</div>

<!-- Modals -->
<div id="modal">
  <div class="modal-box">
    <p>Play <b>Tap Master</b> for <b>10‚≠ê</b>?</p>
    <button id="yesBtn">Yes</button>
    <button id="noBtn">Cancel</button>
  </div>
</div>

<div id="leaderboardModal">
  <div class="modal-box">
    <h3>üèÜ Top Tappers</h3>
    <ol id="scores"></ol>
    <button id="closeLeaderboard">Close</button>
  </div>
</div>

<div id="resultModal">
  <div class="modal-box">
    <h2>Time‚Äôs Up!</h2>
    <p>üëÜ Taps: <span id="finalTaps">0</span></p>
    <p>üíµ Cash Earned: ‚Ç¶<span id="finalEarnings">0.00</span></p>
    <button id="playAgain">Play Again</button>
  </div>
</div>

<!-- Game Page -->
<div id="gamePage">
  <div class="glass-terminal">
    <div class="terminal-header">TAP TERMINAL</div>
    <div class="terminal-line">‚è± Time Left: <span id="timer">60</span>s</div>
    <div class="terminal-line">üëÜ Taps: <span id="tapCount">0</span></div>
    <div class="terminal-line">üíµ Earnings: ‚Ç¶<span id="earnings">0.00</span></div>
    <div id="bonusContainer"><div id="bonusBar"></div></div>
  </div>

  <button id="tapButton">TAP</button>
  <button id="leaderboardBtn">View Leaderboard</button>
</div>

<audio id="tapSound" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg" preload="auto"></audio>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, collection, addDoc, query, where, orderBy, limit, getDocs, serverTimestamp, Timestamp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDbKz4ef_eUDlCukjmnK38sOwueYuzqoao",
  authDomain: "metaverse-1010.firebaseapp.com",
  projectId: "metaverse-1010",
  storageBucket: "metaverse-1010.appspot.com",
  messagingSenderId: "1044064238233",
  appId: "1:1044064238233:web:2fbdfb811cb0a3ba349608"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

window.addEventListener("DOMContentLoaded", () => {
  const startPage = document.getElementById('startPage');
  const gamePage = document.getElementById('gamePage');
  const modal = document.getElementById('modal');
  const resultModal = document.getElementById('resultModal');
  const leaderboardModal = document.getElementById('leaderboardModal');
  const startBtn = document.getElementById('startBtn');
  const yesBtn = document.getElementById('yesBtn');
  const noBtn = document.getElementById('noBtn');
  const playAgain = document.getElementById('playAgain');
  const tapButton = document.getElementById('tapButton');
  const tapSound = document.getElementById('tapSound');
  const timerEl = document.getElementById('timer');
  const tapCountEl = document.getElementById('tapCount');
  const earningsEl = document.getElementById('earnings');
  const bonusBar = document.getElementById('bonusBar');
  const finalTapsEl = document.getElementById('finalTaps');
  const finalEarningsEl = document.getElementById('finalEarnings');
  const scoresEl = document.getElementById('scores');
  const leaderboardBtn = document.getElementById('leaderboardBtn');
  const closeLeaderboard = document.getElementById('closeLeaderboard');

  let taps = 0, earnings = 0, timer = 60, interval;
  let bonusLevel = 1, progress = 0, tapsForNext = 100;

  document.body.addEventListener("touchstart", () => {
    tapSound.play().catch(()=>{});
  }, { once:true });

  startBtn.addEventListener("click", ()=>modal.style.display="flex");
  noBtn.addEventListener("click", ()=>modal.style.display="none");

  yesBtn.addEventListener("click", ()=>{
    modal.style.display="none";
    startPage.style.display="none";
    startGame();
  });

  function startGame(){
    taps = 0; earnings = 0; timer = 60;
    bonusLevel=1; progress=0; tapsForNext=100;

    gamePage.style.display="flex";
    updateStats();
    loadTop5();

    interval = setInterval(()=>{
      timer--;
      timerEl.textContent=timer;
      if(timer<=0) endGame();
    },1000);
  }

  const tapEvent=("ontouchstart" in window)?"touchstart":"click";

  tapButton.addEventListener(tapEvent,(e)=>{
    e.preventDefault();
    if(timer<=0) return;

    taps++; earnings++;
    tapCountEl.textContent=taps;
    earningsEl.textContent=earnings.toFixed(2);

    tapSound.currentTime=0; tapSound.play().catch(()=>{});

    tapButton.classList.add("glow");
    setTimeout(()=>tapButton.classList.remove("glow"),120);

    // BONUS BAR
    progress++;
    if(progress>=tapsForNext){
      progress=0;
      bonusLevel++;
      tapsForNext=100+(bonusLevel-1)*50;
    }
    bonusBar.style.width=(progress/tapsForNext*100)+"%";
  });

  async function endGame(){
    clearInterval(interval);
    gamePage.style.display="none";
    resultModal.style.display="flex";

    finalTapsEl.textContent=taps;
    finalEarningsEl.textContent=earnings.toFixed(2);

    try{
      await addDoc(collection(db,"tapSessions"),{taps,earnings,timestamp:serverTimestamp()});
    }catch(err){console.error(err);}
    loadTop5();
  }

  playAgain.addEventListener("click", ()=>{
    resultModal.style.display="none";
    startPage.style.display="flex";
  });

  leaderboardBtn.addEventListener("click", ()=>leaderboardModal.style.display="flex");
  closeLeaderboard.addEventListener("click", ()=>leaderboardModal.style.display="none");

  async function loadTop5(){
    const oneHourAgo = Timestamp.fromDate(new Date(Date.now()-3600000));
    const q=query(
      collection(db,"tapSessions"),
      where("timestamp",">",oneHourAgo),
      orderBy("timestamp","desc"),
      orderBy("taps","desc"),
      limit(5)
    );

    const snap = await getDocs(q);

    scoresEl.innerHTML = snap.docs.map((doc,i)=>{
      const s = doc.data();
      return `<li>#${i+1} ‚Äî ${s.taps} taps (‚Ç¶${(s.earnings||0).toFixed(2)})</li>`;
    }).join("");
  }
});
</script>
</body>
</html>